<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Studio Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0F0F1A;
            --bg-surface: #1A1A2E;
            --bg-glass: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
            --border-focus: rgba(139,92,246,0.5);
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --accent: #8B5CF6;
            --accent-glow: rgba(139,92,246,0.4);
            --accent-soft: rgba(139,92,246,0.15);
            --success: #10B981;
            --danger: #EF4444;
            --input-bg: rgba(255,255,255,0.05);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Layout Principal - Split Screen */
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 100vh;
        }
        
        @media (max-width: 1200px) {
            .app-container { grid-template-columns: 1fr; }
            .preview-panel { display: none; }
        }

        /* Panel del Formulario */
        .form-panel {
            padding: 32px 48px;
            overflow-y: auto;
            max-height: 100vh;
        }
        
        /* Header */
        .header {
            margin-bottom: 32px;
        }
        
        .logo {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, #EC4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .tagline {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Barra de Progreso */
        .progress-container {
            margin-bottom: 32px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .progress-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .progress-percent {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .progress-bar {
            height: 6px;
            background: var(--input-bg);
            border-radius: 100px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #EC4899 100%);
            border-radius: 100px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        /* Secciones - Glassmorphism */
        .section {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            transition: border-color 0.3s ease;
        }
        
        .section:hover {
            border-color: rgba(255,255,255,0.12);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .section-icon {
            width: 36px;
            height: 36px;
            background: var(--accent-soft);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }
        
        .section-title {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Grid de Inputs */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        @media (max-width: 600px) {
            .input-grid { grid-template-columns: 1fr; }
        }
        
        .input-full { grid-column: 1 / -1; }

        /* Input con Floating Label */
        .input-group {
            position: relative;
        }
        
        .input-field {
            width: 100%;
            padding: 16px 16px 8px;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .input-field::placeholder {
            color: transparent;
        }
        
        .input-field:focus {
            border-color: var(--border-focus);
            background: rgba(139,92,246,0.05);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .input-label {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.95rem;
            pointer-events: none;
            transition: all 0.2s ease;
        }
        
        .input-field:focus + .input-label,
        .input-field:not(:placeholder-shown) + .input-label {
            top: 8px;
            transform: translateY(0);
            font-size: 0.7rem;
            color: var(--accent);
        }
        
        textarea.input-field {
            min-height: 100px;
            resize: vertical;
            padding-top: 24px;
        }
        
        textarea.input-field + .input-label {
            top: 16px;
            transform: translateY(0);
        }
        
        textarea.input-field:focus + .input-label,
        textarea.input-field:not(:placeholder-shown) + .input-label {
            top: 8px;
        }
        
        /* Select Estilizado */
        .select-field {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2394A3B8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 44px;
            cursor: pointer;
        }

        /* Tarjetas de Template */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 800px) {
            .template-grid { grid-template-columns: repeat(3, 1fr); }
        }
        
        .template-card {
            aspect-ratio: 3/4;
            background: var(--input-bg);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }
        
        .template-card:hover {
            border-color: var(--text-muted);
            transform: translateY(-2px);
        }
        
        .template-card.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .template-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
        }
        
        .template-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            font-size: 0.7rem;
            font-weight: 500;
            text-align: center;
            text-transform: capitalize;
        }
        
        /* Items Dinámicos */
        .dynamic-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .dynamic-item {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 20px;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            background: rgba(239,68,68,0.15);
            border: none;
            border-radius: 6px;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .remove-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Botones */
        .btn-add {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-add:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-soft);
        }
        
        .btn-primary {
            width: 100%;
            padding: 18px 32px;
            background: linear-gradient(135deg, var(--accent) 0%, #7C3AED 100%);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .btn-primary:hover::before {
            opacity: 1;
        }
        
        .btn-primary span {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* AI Suggestion Box */
        .ai-suggestion {
            background: linear-gradient(135deg, rgba(139,92,246,0.1) 0%, rgba(236,72,153,0.1) 100%);
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 12px;
        }
        
        .ai-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: var(--accent);
            font-weight: 500;
        }
        
        .ai-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .ai-apply {
            margin-top: 12px;
            padding: 8px 16px;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* Panel de Preview */
        .preview-panel {
            background: #141420;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100vh;
        }
        
        .preview-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .preview-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .preview-actions {
            display: flex;
            gap: 8px;
        }
        
        .preview-btn {
            padding: 6px 12px;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
        }
        
        .preview-content {
            flex: 1;
            padding: 24px;
            overflow: auto;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        .preview-frame {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 8.5/11;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .preview-frame iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15,15,26,0.9);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 24px;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Panel del Formulario -->
        <div class="form-panel">
            <header class="header">
                <h1 class="logo">CV Studio</h1>
                <p class="tagline">Crea tu currículum profesional en minutos</p>
            </header>
            
            <!-- Barra de Progreso -->
            <div class="progress-container">
                <div class="progress-header">
                    <span class="progress-label">Progreso del CV</span>
                    <span class="progress-percent" id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <form id="cvForm">
                <!-- Plantilla -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                        </div>
                        <h2 class="section-title">Elige tu plantilla</h2>
                    </div>
                    
                    <div class="template-grid" id="templateGrid">
                        {% for theme in themes %}
                        <div class="template-card {% if loop.first %}active{% endif %}" data-theme="{{ theme }}" onclick="selectTemplate('{{ theme }}')">
                            <img src="/preview/{{ theme }}" alt="{{ theme }}" onerror="this.style.display='none'">
                            <span class="template-name">{{ theme }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <input type="hidden" id="theme" value="classic">
                    
                    <div class="input-grid" style="margin-top: 16px;">
                        <div class="input-group">
                            <select class="input-field select-field" id="language">
                                <option value="spanish">Español</option>
                                <option value="english">English</option>
                            </select>
                            <label class="input-label" style="top: 8px; transform: none; font-size: 0.7rem; color: var(--accent);">Idioma del CV</label>
                        </div>
                    </div>
                </div>

                <!-- Información Personal -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"/></svg>
                        </div>
                        <h2 class="section-title">Información Personal</h2>
                    </div>
                    
                    <div class="input-grid">
                        <div class="input-group">
                            <input type="text" class="input-field" id="name" placeholder=" " required>
                            <label class="input-label">Nombre completo *</label>
                        </div>
                        <div class="input-group">
                            <input type="text" class="input-field" id="headline" placeholder=" ">
                            <label class="input-label">Título profesional</label>
                        </div>
                        <div class="input-group">
                            <input type="email" class="input-field" id="email" placeholder=" " required>
                            <label class="input-label">Email *</label>
                        </div>
                        <div class="input-group">
                            <input type="tel" class="input-field" id="phone" placeholder=" ">
                            <label class="input-label">Teléfono</label>
                        </div>
                        <div class="input-group">
                            <input type="text" class="input-field" id="location" placeholder=" ">
                            <label class="input-label">Ubicación</label>
                        </div>
                        <div class="input-group">
                            <input type="url" class="input-field" id="website" placeholder=" ">
                            <label class="input-label">Sitio web</label>
                        </div>
                        <div class="input-group">
                            <input type="text" class="input-field" id="linkedin" placeholder=" ">
                            <label class="input-label">LinkedIn (usuario)</label>
                        </div>
                        <div class="input-group">
                            <input type="text" class="input-field" id="github" placeholder=" ">
                            <label class="input-label">GitHub (usuario)</label>
                        </div>
                    </div>
                </div>

                <!-- Resumen Profesional -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
                        </div>
                        <h2 class="section-title">Resumen Profesional</h2>
                    </div>
                    
                    <div class="dynamic-list" id="summaryList"></div>
                    <button type="button" class="btn-add" onclick="addSummary()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar párrafo
                    </button>
                    
                    <div class="ai-suggestion" id="aiSuggestion" style="display: none;">
                        <div class="ai-header">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            Sugerencia con IA
                        </div>
                        <p class="ai-text" id="aiText"></p>
                        <button type="button" class="ai-apply" onclick="applyAiSuggestion()">Aplicar sugerencia</button>
                    </div>
                </div>
                
                <!-- Experiencia -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/></svg>
                        </div>
                        <h2 class="section-title">Experiencia Laboral</h2>
                    </div>
                    
                    <div class="dynamic-list" id="experienceList"></div>
                    <button type="button" class="btn-add" onclick="addExperience()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar experiencia
                    </button>
                </div>

                <!-- Educación -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/></svg>
                        </div>
                        <h2 class="section-title">Educación</h2>
                    </div>
                    
                    <div class="dynamic-list" id="educationList"></div>
                    <button type="button" class="btn-add" onclick="addEducation()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar educación
                    </button>
                </div>
                
                <!-- Proyectos -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
                        </div>
                        <h2 class="section-title">Proyectos</h2>
                    </div>
                    
                    <div class="dynamic-list" id="projectsList"></div>
                    <button type="button" class="btn-add" onclick="addProject()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar proyecto
                    </button>
                </div>
                
                <!-- Skills -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        </div>
                        <h2 class="section-title">Habilidades</h2>
                    </div>
                    
                    <div class="dynamic-list" id="skillsList"></div>
                    <button type="button" class="btn-add" onclick="addSkill()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Agregar habilidad
                    </button>
                </div>
                
                <button type="submit" class="btn-primary" id="submitBtn">
                    <span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Generar CV
                    </span>
                </button>
            </form>
        </div>

        <!-- Panel de Preview -->
        <div class="preview-panel">
            <div class="preview-header">
                <span class="preview-title">Vista previa en tiempo real</span>
                <div class="preview-actions">
                    <button class="preview-btn" onclick="refreshPreview()">↻ Actualizar</button>
                </div>
            </div>
            <div class="preview-content">
                <div class="preview-frame">
                    <iframe id="previewFrame" src="/preview/classic"></iframe>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p class="loading-text">Generando tu CV profesional...</p>
    </div>

    <script>
        // Seleccionar plantilla
        function selectTemplate(theme) {
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('active'));
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            document.getElementById('theme').value = theme;
            document.getElementById('previewFrame').src = '/preview/' + theme;
        }
        
        // Actualizar preview
        function refreshPreview() {
            const theme = document.getElementById('theme').value;
            const iframe = document.getElementById('previewFrame');
            iframe.src = '/preview/' + theme + '?t=' + Date.now();
        }
        
        // Calcular progreso
        function updateProgress() {
            const fields = ['name', 'email', 'headline', 'phone', 'location', 'website', 'linkedin', 'github'];
            let filled = 0;
            fields.forEach(id => {
                if (document.getElementById(id)?.value.trim()) filled++;
            });
            
            // Contar secciones dinámicas
            const summaries = document.querySelectorAll('.summary-item').length;
            const experiences = document.querySelectorAll('.experience-item').length;
            const educations = document.querySelectorAll('.education-item').length;
            const skills = document.querySelectorAll('.skill-item').length;
            
            if (summaries > 0) filled += 2;
            if (experiences > 0) filled += 2;
            if (educations > 0) filled += 2;
            if (skills > 0) filled += 1;
            
            const total = fields.length + 7;
            const percent = Math.min(100, Math.round((filled / total) * 100));
            
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
        }
        
        // Observar cambios en inputs
        document.addEventListener('input', updateProgress);

        // Agregar elementos dinámicos
        function addSummary() {
            const list = document.getElementById('summaryList');
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateProgress();">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="input-group">
                    <textarea class="input-field summary-item" placeholder=" " onblur="generateAiSuggestion()"></textarea>
                    <label class="input-label">Describe tu perfil profesional</label>
                </div>
            `;
            list.appendChild(div);
            updateProgress();
        }
        
        function addExperience() {
            const list = document.getElementById('experienceList');
            const div = document.createElement('div');
            div.className = 'dynamic-item experience-item';
            div.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateProgress();">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="input-grid">
                    <div class="input-group">
                        <input type="text" class="input-field exp-company" placeholder=" ">
                        <label class="input-label">Empresa</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field exp-position" placeholder=" ">
                        <label class="input-label">Cargo</label>
                    </div>
                    <div class="input-group">
                        <input type="month" class="input-field exp-start" placeholder=" ">
                        <label class="input-label" style="top:8px;transform:none;font-size:0.7rem;color:var(--accent)">Fecha inicio</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field exp-end" placeholder=" ">
                        <label class="input-label">Fecha fin (o "present")</label>
                    </div>
                    <div class="input-group input-full">
                        <input type="text" class="input-field exp-location" placeholder=" ">
                        <label class="input-label">Ubicación</label>
                    </div>
                    <div class="input-group input-full">
                        <textarea class="input-field exp-highlights" placeholder=" "></textarea>
                        <label class="input-label">Logros (uno por línea)</label>
                    </div>
                </div>
            `;
            list.appendChild(div);
            updateProgress();
        }

        function addEducation() {
            const list = document.getElementById('educationList');
            const div = document.createElement('div');
            div.className = 'dynamic-item education-item';
            div.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateProgress();">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="input-grid">
                    <div class="input-group">
                        <input type="text" class="input-field edu-institution" placeholder=" ">
                        <label class="input-label">Institución</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field edu-degree" placeholder=" ">
                        <label class="input-label">Título</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field edu-area" placeholder=" ">
                        <label class="input-label">Área de estudio</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field edu-location" placeholder=" ">
                        <label class="input-label">Ubicación</label>
                    </div>
                    <div class="input-group">
                        <input type="month" class="input-field edu-start" placeholder=" ">
                        <label class="input-label" style="top:8px;transform:none;font-size:0.7rem;color:var(--accent)">Fecha inicio</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field edu-end" placeholder=" ">
                        <label class="input-label">Fecha fin</label>
                    </div>
                </div>
            `;
            list.appendChild(div);
            updateProgress();
        }
        
        function addProject() {
            const list = document.getElementById('projectsList');
            const div = document.createElement('div');
            div.className = 'dynamic-item project-item';
            div.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateProgress();">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="input-grid">
                    <div class="input-group input-full">
                        <input type="text" class="input-field proj-name" placeholder=" ">
                        <label class="input-label">Nombre del proyecto</label>
                    </div>
                    <div class="input-group input-full">
                        <textarea class="input-field proj-summary" placeholder=" "></textarea>
                        <label class="input-label">Descripción</label>
                    </div>
                </div>
            `;
            list.appendChild(div);
            updateProgress();
        }
        
        function addSkill() {
            const list = document.getElementById('skillsList');
            const div = document.createElement('div');
            div.className = 'dynamic-item skill-item';
            div.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateProgress();">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="input-grid">
                    <div class="input-group">
                        <input type="text" class="input-field skill-label" placeholder=" ">
                        <label class="input-label">Categoría</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field skill-details" placeholder=" ">
                        <label class="input-label">Tecnologías</label>
                    </div>
                </div>
            `;
            list.appendChild(div);
            updateProgress();
        }

        // AI Suggestion (simulado)
        function generateAiSuggestion() {
            const headline = document.getElementById('headline').value;
            const summaryItems = document.querySelectorAll('.summary-item');
            
            if (headline && summaryItems.length > 0) {
                const suggestions = [
                    `Profesional con experiencia demostrada en ${headline.toLowerCase()}, enfocado en entregar soluciones de alto impacto y valor medible para las organizaciones.`,
                    `${headline} orientado a resultados con habilidades comprobadas en liderazgo técnico, optimización de procesos y desarrollo de soluciones escalables.`,
                    `Especialista en ${headline.toLowerCase()} con pasión por la innovación tecnológica y un historial de éxito en proyectos de alta complejidad.`
                ];
                
                const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                document.getElementById('aiText').textContent = randomSuggestion;
                document.getElementById('aiSuggestion').style.display = 'block';
            }
        }
        
        function applyAiSuggestion() {
            const suggestion = document.getElementById('aiText').textContent;
            const summaryItems = document.querySelectorAll('.summary-item');
            if (summaryItems.length > 0) {
                summaryItems[0].value = suggestion;
                document.getElementById('aiSuggestion').style.display = 'none';
                updateProgress();
            }
        }
        
        // Recopilar datos
        function collectFormData() {
            const data = {
                theme: document.getElementById('theme').value,
                language: document.getElementById('language').value,
                name: document.getElementById('name').value,
                headline: document.getElementById('headline').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                website: document.getElementById('website').value,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                summary: [],
                experience: [],
                education: [],
                projects: [],
                skills: []
            };

            document.querySelectorAll('.summary-item').forEach(el => {
                if (el.value.trim()) data.summary.push(el.value.trim());
            });

            document.querySelectorAll('.experience-item').forEach(el => {
                const exp = {
                    company: el.querySelector('.exp-company').value,
                    position: el.querySelector('.exp-position').value,
                    start_date: el.querySelector('.exp-start').value,
                    end_date: el.querySelector('.exp-end').value || 'present',
                    location: el.querySelector('.exp-location').value,
                    highlights: el.querySelector('.exp-highlights').value.split('\n').filter(h => h.trim()).map(h => h.replace(/^-\s*/, ''))
                };
                if (exp.company) data.experience.push(exp);
            });

            document.querySelectorAll('.education-item').forEach(el => {
                const edu = {
                    institution: el.querySelector('.edu-institution').value,
                    degree: el.querySelector('.edu-degree').value,
                    area: el.querySelector('.edu-area').value,
                    location: el.querySelector('.edu-location').value,
                    start_date: el.querySelector('.edu-start').value,
                    end_date: el.querySelector('.edu-end').value
                };
                if (edu.institution) data.education.push(edu);
            });

            document.querySelectorAll('.project-item').forEach(el => {
                const proj = {
                    name: el.querySelector('.proj-name').value,
                    summary: el.querySelector('.proj-summary').value
                };
                if (proj.name) data.projects.push(proj);
            });

            document.querySelectorAll('.skill-item').forEach(el => {
                const skill = {
                    label: el.querySelector('.skill-label').value,
                    details: el.querySelector('.skill-details').value
                };
                if (skill.label) data.skills.push(skill);
            });

            return data;
        }

        // Enviar formulario
        document.getElementById('cvForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const loading = document.getElementById('loadingOverlay');
            
            btn.disabled = true;
            loading.classList.add('active');

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(collectFormData())
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'mi_cv.pdf';
                    a.click();
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (err) {
                alert('Error de conexión: ' + err.message);
            } finally {
                btn.disabled = false;
                loading.classList.remove('active');
            }
        });

        // Inicializar
        addSummary();
        addExperience();
        addEducation();
        addSkill();
        updateProgress();
    </script>
</body>
</html>
